# Shape Slayer

**Rogue-like geometry warfare you can launch in a browser. Dodge, dash, and demolish waves of hostile shapes solo or with friends.**

Shape Slayer is a fast, skill-first top-down action roguelike built for quick runs and high replayability. Choose your favorite class of sentient shape, dive into procedurally scaled combat arenas, and stack wild gear affixes that turn every run into a new buildcraft playground.

## Why You’ll Love It

- **Arcade-speed combat:** Tight eight-directional movement, snappy attacks, invincible dodges, and a constant flow of enemies.
- **Boss battles with personality:** Cinematic intros, multi-phase move sets, breakable weak points, and arenas that fight back.
- **Endless build tinkering:** Loot tiers, legendary effects, class-specific modifiers, and a persistent upgrade hub keep you chasing the next broken combo.
- **Drop-in multiplayer:** Up to four players can queue up instantly with six-character lobby codes. Host migration and reconnection mean a disconnect won’t kill the run.
- **Runs anywhere:** No installs, no frameworks—just open the page and start slaying.

## Jump In

| How you want to play | What to do |
| --- | --- |
| **Solo or hot-seat** | Open `index.html` in a modern desktop or mobile browser. That’s it. |
| **Squad up online** | Open the game, create or join a lobby from the pause menu, share the six-character code, and you’re in. |

## Pick Your Shape

| Class | Fantasy | Signature Moves |
| --- | --- | --- |
| **Warrior** (Square) | Blade-dancing frontline bruiser | Straight-line blade strikes, forward thrust heavy with full i-frames, whirlwind special |
| **Rogue** (Triangle) | Crit-hunting assassin | Knife barrages, double dodge charges, backstabs that explode damage numbers |
| **Tank** (Pentagon) | Crowd-controlling bulwark | Life-stealing hammer swings, Shout stun/slow, shield wall that retaliates |
| **Mage** (Hexagon) | Mobile artillery | Basic spell bolts, piercing beam heavy, blink + nova special with decoy |

Every class has bespoke config-tuned stats, animations, and gear synergies—rotate through them to learn how each handles the escalating chaos.

## What’s Waiting in the Arenas

### Combat That Rewards Movement
- Dash through swarms, bait elite assassins, and kite projectile barrages across oversized 2400×1350 arenas built for momentum.
- Screen shake, hit pause, crit/backstab markers, and pop-up damage/heal numbers reinforce every big play.
- When enemies hide off-screen, smart enemy arrows point you straight to the last stragglers so pacing never dies.

### Boss Fights Worth Showing Off
- Room 10 onward kicks off a boss gauntlet: Swarm King, Twin Prism, Fortress, Fractal Core, and the vortexing final boss.
- Each fight brings unique hazards (shockwaves, pull fields, collapsing debris) and phase shifts at 50%/25% HP that force you to adapt.
- Crack glowing weak points for 3× bonus damage, stack the loot guarantees, and bask in the dramatic intros (or skip them with a tap if you’re on a speedrun).

### Buildcrafter’s Playground
- Discover weapons that transform your kit: dual-hit “Parallel” blades, long-reaching “Vector” polearms, or “Obtuse” heavy hitters with built-in knockback and stuns.
- Armor archetypes push you toward niche play: “Fractal” light armor fuels speed junkies, while “Tessellated” plating makes you an immovable crowd-control machine.
- Legendary effects add run-defining perks like Phoenix Down revives, Chain Lightning procs, Berserker Rage risk/reward, and time-slow gimmicks.
- Keep earning currency to feed the Nexus hub’s permanent upgrades, unlocking new stat ceilings across every class.

## Loot & Affixes

### Weapon Archetypes

| Archetype | Highlights |
| --- | --- |
| Acute (fast) | 30% quicker swings, slight damage tradeoff, free move speed boost |
| Obtuse (heavy) | Chunkier hits, bonus knockback, 15% stun chance |
| Vector (reach) | Extended melee range and projectile travel | 
| Parallel (dual) | Double-hit basics, built-in crit, low per-hit damage |

### Armor Archetypes

| Archetype | Highlights |
| --- | --- |
| Fractal (light) | +20% speed, extra dodge charge, dodge damage reduction |
| Polygon (medium) | Baseline defense plus flat 10% HP |
| Tessellated (heavy) | Huge defense, interrupt/knockback immunity, slight speed penalty |
| Membrane (cloth) | 15% cooldown reduction and faster projectiles |

### Legendary Effects (Orange Tier)

| Effect | What it does |
| --- | --- |
| Vampiric | 8% lifesteal on everything |
| Incendiary | Adds a 3 s burn DoT based on damage dealt |
| Freezing | 20% chance to slow enemies by 50% for 2 s |
| Thorns | Reflects 25% damage back at attackers |
| Berserker Rage | +25% damage with -20% defense tradeoff |
| Glass Cannon | +45% damage but -40% max HP |
| Phoenix Down | Auto-revive each room at 30% HP (recharges through damage) |
| Time Dilation | Slows time 20% on hit |
| Chain Lightning | Forks to two extra enemies at 60% damage |

### Affix Pools

**Basic Tier**

| Affix | Slots | Effect |
| --- | --- | --- |
| movementSpeed | armor, accessory | +10–15% movement speed |
| attackSpeed | weapon, accessory | +10–20% attack speed |
| projectileSpeed | weapon, accessory | +15–25% projectile speed |
| maxHealth | armor | +15–40 flat HP |
| knockbackPower | weapon | +20–50% knockback |

**Advanced Tier**

| Affix | Slots | Effect |
| --- | --- | --- |
| critChance | weapon, accessory | +5–15% crit chance |
| critDamage | weapon | +15–45% crit damage multiplier |
| lifesteal | weapon, armor | +3–10% lifesteal |
| cooldownReduction | accessory, armor | -8–15% cooldowns (up to 75% cap) |
| areaOfEffect | weapon | +12–28% AoE radius |
| beamTickRate | weapon, accessory | 15–35% faster Mage beam ticks |
| beamDuration | weapon, accessory | +20–50% Mage beam duration |

**Rare Tier**

| Affix | Slots | Effect |
| --- | --- | --- |
| dodgeCharges | armor, accessory | +1 dodge charge |
| pierce | weapon | +1–3 projectile pierce |
| chainLightning | weapon | +1–2 chain targets |
| execute | weapon | +25–50% damage vs enemies under 30% HP |
| rampage | weapon, accessory | +4–12% stacking damage per kill (up to 5 stacks) |
| multishot | weapon | +1–2 additional projectiles |
| phasing | armor, accessory | +10–25% chance to ignore collisions |
| explosiveAttacks | weapon | +12–25% chance to spawn explosions on hit |
| fortify | armor | Converts 5–15% damage dealt into a decaying shield |
| overcharge | accessory | +15–30% chance to refund heavy/special/dodge cooldowns |
| beamCharges | weapon, accessory | +1 Mage beam charge |
| beamPenetration | weapon, accessory | +1–2 beam penetration |

Legendary gear always rolls one of the effects above **in addition** to its affixes, and purple/orange items can carry class-specific modifiers that push builds into truly absurd territory.

## Party Up

- **Zero-fuss lobbies:** Hit the pause menu, generate a code, and have friends join from any device or browser tab.
- **Smooth experience:** Enjoy buttery 60 FPS interpolation, automatic reconnection attempts, and instant host migration if someone disconnects.
- **Shared glory:** End-of-run scoreboards highlight damage dealt, kills, room clears, and time alive so you can flex the carry (or blame the throw).
- **Spectator mode:** If you drop in multiplayer, press `Space` to hop between living teammates and keep calling the shots.

## Controls

### Keyboard & Mouse
- Movement: `WASD`
- Aim: Mouse
- Basic Attack: `Left Click`
- Heavy Attack: `Right Click`
- Dodge: `Shift`
- Special Ability: `Space`
- Restart / Menu: `R` / `M`
- Pause / Multiplayer Menu: `ESC`
- Debug Panel: `Ctrl+D`
- Host Action: `G` at the Nexus portal to launch a run

### Touch
- Twin virtual joysticks keep movement and aiming intuitive.
- Dedicated ability buttons show cooldowns, charges, and activation states.
- UI repositions itself automatically on rotate or resize so you’re never fighting the interface.

## Want to Host Your Own Server?

```bash
cd server
npm install
npm start               # SERVER_MODE=single by default
# Advanced:
SERVER_MODE=multi WORKER_COUNT=4 npm start   # clustered (needs Docker/Redis)
SERVER_MODE=slave MASTER_SERVER_IP=10.0.0.100 WORKER_COUNT=4 npm start   # scale-out
```

- Default WebSocket port: **4000**
- Configure lobby size, interpolation, and reconnect behavior in `js/mp-config.js`
- Sample production URL (`wss://shape-slayer.goodgirl.software`) ships ready to play if you don’t want to self-host

## Credits & Community

Shape Slayer is an evolving passion project focused on readability, responsiveness, and relentless fun. Dive in, break the build systems, and let us know what ridiculous combos you discover.

- **Bugs or ideas?** Open an issue on GitHub.
- **Want to contribute?** The codebase is plain vanilla JavaScript—fork it and go wild.
- **Need help?** Check the in-game debug panel (`Ctrl+D`), the console, or server logs for detailed output.

## Classes

| Class | Role | Signature Kit |
| --- | --- | --- |
| Warrior (Square) | Balanced bruiser | Wide sword swings, thrust dash with i-frames, whirlwind special |
| Rogue (Triangle) | High mobility assassin | Crit-focused basics, fan-of-knives heavy, shadow-clone special, backstab bonus |
| Tank (Pentagon) | Crowd control & sustain | Hammer lifesteal basics, Shout stun/slow heavy, directional shield special, retaliatory knockback passive |
| Mage (Hexagon) | Ranged spellcaster | Charged bolts, beam heavy, blink + nova special, beam-specific gear synergies |

Class tooltips in the Nexus pull straight from the config templates, so designer-written copy stays accurate as balance changes.

## Enemies & Bosses

- Normal rooms mix circles (swarmers), stars (ranged), diamonds (assassins), rectangles (brutes), and octagons (elites) with threat-table driven aggro.
- Bosses spawn every five rooms from 10 onward (Swarm King, Twin Prism, Fortress, Fractal Core, Vortex). Each has three escalating phases, bespoke hazards, and guaranteed rare+ loot.
- Multiplayer scaling adjusts count, HP, and damage per player without overwhelming low-end machines.

## Gear Reference

### Weapon Archetypes

| Archetype | Notes |
| --- | --- |
| Acute (fast) | 30% faster attacks, slight damage nerf, +15% move speed |
| Obtuse (heavy) | 25% more damage, slight speed penalty, bonus knockback & 15% stun chance |
| Vector (reach) | Longer melee reach and projectile travel range |
| Parallel (dual) | Double-hit basics, crit bonus, lower per-hit damage |

### Armor Archetypes

| Archetype | Notes |
| --- | --- |
| Fractal (light) | -25% defense, +20% speed, +1 dodge charge, dodge damage reduction |
| Polygon (medium) | Flat 10% health bonus, baseline defense |
| Tessellated (heavy) | +30% defense, -10% speed, interrupt & knockback immunity |
| Membrane (cloth) | +15% cooldown reduction, +20% projectile speed |

### Legendary Effects (Orange Tier)

| Effect | Description |
| --- | --- |
| Vampiric | +8% lifesteal on all damage sources |
| Incendiary | Applies 3 s burn DoT based on damage dealt |
| Freezing | 20% slow chance with 50% reduction for 2 s |
| Thorns | Reflects 25% incoming damage |
| Berserker Rage | +25% damage, -20% defense |
| Glass Cannon | +45% damage, -40% max HP |
| Phoenix Down | Auto-revive once per room at 30% HP (recharges via damage dealt) |
| Time Dilation | 20% time-slow effect |
| Chain Lightning | Chains damage to two extra targets at 60% power |

Purple/orange gear can also roll class modifiers (e.g., +1 Rogue dodge charge, +150 Mage blink range, +1 Tank shield second, universal cooldown reductions), enabling run-defining builds.

### Affix Tables

**Basic Tier**

| Affix | Slots | Effect |
| --- | --- | --- |
| movementSpeed | armor, accessory | +10–15% movement speed |
| attackSpeed | weapon, accessory | +10–20% attack speed |
| projectileSpeed | weapon, accessory | +15–25% projectile speed |
| maxHealth | armor | +15–40 flat HP |
| knockbackPower | weapon | +20–50% knockback |

**Advanced Tier**

| Affix | Slots | Effect |
| --- | --- | --- |
| critChance | weapon, accessory | +5–15% crit chance |
| critDamage | weapon | +15–45% crit damage multiplier |
| lifesteal | weapon, armor | +3–10% lifesteal |
| cooldownReduction | accessory, armor | -8–15% ability cooldowns (caps at 75%) |
| areaOfEffect | weapon | +12–28% AoE radius |
| beamTickRate | weapon, accessory | 15–35% faster Mage beam ticks |
| beamDuration | weapon, accessory | +20–50% Mage beam duration |

**Rare Tier**

| Affix | Slots | Effect |
| --- | --- | --- |
| dodgeCharges | armor, accessory | +1 dodge charge |
| pierce | weapon | +1–3 projectile pierce |
| chainLightning | weapon | +1–2 chain targets |
| execute | weapon | +25–50% bonus damage vs enemies under 30% HP |
| rampage | weapon, accessory | +4–12% stacking damage per Rampage stack (caps at 5 stacks) |
| multishot | weapon | +1–2 additional projectiles |
| phasing | armor, accessory | +10–25% chance to ignore collisions |
| explosiveAttacks | weapon | +12–25% chance to spawn explosions on hit |
| fortify | armor | Converts 5–15% dealt damage into decaying shields |
| overcharge | accessory | +15–30% chance to refund heavy/special/dodge cooldowns |
| beamCharges | weapon, accessory | +1 Mage beam charge |
| beamPenetration | weapon, accessory | +1–2 beam penetration |

Legendary items always receive one of the effects above in addition to their rolled affixes.

## Controls

### Keyboard & Mouse
- `WASD` move, mouse aims.
- `Left Click` basic attack, `Right Click` heavy attack.
- `Shift` dodge, `Space` special ability, `R` restart, `M` main menu.
- `ESC` opens pause/multiplayer menu, `Ctrl+D` toggles debug panel.
- Host-exclusive: `G` at the Nexus portal starts a run.

### Touch & Hybrid
- Dual virtual joysticks for movement and aiming.
- Dedicated buttons for heavy, special, and dodge with charge counters and cooldown shading.
- Auto-layout recalculates on viewport resize/orientation change.

### Spectator Mode
- In multiplayer, dead players can press `Space` to follow teammates. HUD shows the tracked player and enemy arrows still assist navigation.

## Multiplayer Workflow

1. Host launches the WebSocket server and game client, creates a lobby, and shares the six-character code.
2. Clients join from new browser windows or devices; upgrades and currency sync from their save data.
3. Host selects `G` in the Nexus to start the run. Host remains authoritative for combat, loot, and room transitions.
4. Disconnections trigger up to three automated reconnection attempts. If the host drops, the worker assigns a new host and sends `host_migrated`.
5. End-of-run stats (damage dealt, kills, rooms cleared, time alive) broadcast from the host for a shared death screen.

Configure endpoints, interpolation, and reconnection caps in `js/mp-config.js`.

## Progression & Meta Systems

- `SaveSystem` persists currency, per-class upgrade levels, selected class, control mode, fullscreen preference, audio settings, and modal state in `localStorage`.
- Update and launch modals surface patch notes from `js/version.js` whenever `GameVersion.VERSION` changes.
- Player stats tracking (`PlayerStats`) records run metrics for final summaries and cross-player comparisons.
- Nexus layout includes class pads (left wing) and upgrade stations (right wing) with interactable pads in both desktop and touch modes.

## Debugging & Testing

- Toggle the debug panel with `Ctrl+D` or `DebugPanel.toggle()` to warp to rooms 1–30 or enter a custom room number.
- Verbose logging flags live under `DebugFlags` (e.g., enable `DebugFlags.DAMAGE_NUMBERS = true` for sync investigations).
- Automated Puppeteer test for multiplayer damage-number parity:
  ```bash
  cd tests
  npm install
  node damage-numbers.test.js
  ```
  The test spins up the server, launches host/client browsers, and validates send/receive/render stages with logged checkpoints.

## Project Structure

```
shape_slayer/
├── index.html                 # Game shell
├── server.js                  # Optional static dev server (port 3000)
├── css/style.css              # UI styling
├── js/
│   ├── main.js                # Game loop, camera, state machine, run orchestration
│   ├── ui.js                  # HUD, menus, scoreboards, enemy arrows, modals
│   ├── combat.js              # Damage, crit, execute, rampage, lifesteal, legendary procs
│   ├── level.js               # Room generation, scaling, boss spawning
│   ├── gear.js                # Loot rolls, affix pools, class modifiers, legendary effects
│   ├── players/               # Base player + Warrior/Rogue/Tank/Mage subclasses
│   ├── enemies/               # Enemy archetypes with threat/aggro logic
│   ├── bosses/                # Boss implementations and hazard system
│   ├── multiplayer.js         # Client-side lobby/state management
│   ├── mp-config.js           # Multiplayer tuning knobs
│   ├── interpolation.js       # Client smoothing and extrapolation helpers
│   ├── audio.js               # Procedural Web Audio soundscape
│   ├── touch-controls.js      # Virtual joystick/button system
│   ├── nexus.js               # Hub layout, upgrade pads, class info
│   ├── save.js                # Persistence helpers
│   ├── debug.js               # DebugPanel & DebugFlags
│   └── version.js             # Patch notes & tagging
├── server/                    # WebSocket host (single, clustered, slave modes)
│   ├── mp-server.js / master / worker
│   ├── config.js              # Host/port/Redis config
│   └── package.json
├── tests/                     # Puppeteer regression suite
│   ├── damage-numbers.test.js
│   ├── README.md
│   └── package.json
├── MULTIPLAYER.md             # In-depth multiplayer docs
├── spec_sheet.md              # Design spec
├── implementation_plan.md     # Roadmap
└── DAMAGE_NUMBERS_*.md        # Debug notes & final report
```

## Telemetry & Analytics

- **Service Harness** (`harness/index.js`) orchestrates the multiplayer server, metrics ingestion service, and metrics dashboard from a single command. Run `npm run server` at the repo root to start all three; logs stream to the console and persist at `harness/logs/*.log`. Use `--only=mp,metrics`, `--skip=gui`, or `--list` to control which services run, and `--log-dir=/custom/path` to override the log destination.
- **Client instrumentation** (`js/telemetry.js`) collects per-run metrics (damage, hits, room timings, boss encounters) in solo or multiplayer host sessions. Data posts to the ingestion endpoint once a run ends.
- **Ingestion service** (`metrics/server`) listens on port `4001`, validates payloads, and stores them in SQLite.
  ```bash
  cd metrics/server
  npm install
  npm run dev            # or npm start for production
  # optional: node --test tests/ingest.test.js
  ```
  Configure the service via environment variables:
  - `METRICS_PORT` (default `4001`)
  - `METRICS_DB_PATH` (custom SQLite location)
  - `METRICS_INGEST_TOKEN` (required header for uploads)
  Use `samples/sample-run.json` to seed local data while developing the dashboard.
- **Analytics GUI** (`metrics/gui`) serves a dashboard on port `5000` and reads from the shared SQLite database.
  ```bash
  cd metrics/gui
  npm install
  npm run dev            # launches on port 5000 by default
  ```
  Endpoints:
  - `GET /api/summary` – aggregate KPIs (runs, modes, affixes, boss stats)
  - `GET /api/runs?limit=50` – latest runs with damage and hit totals
  - `GET /api/runs/:runId` – deep dive (players, rooms, boss encounters, affixes)
- **Testing** – `tests/telemetry-client.test.js` validates serialization logic, and `metrics/server/tests/ingest.test.js` covers payload ingestion + idempotency.

## Troubleshooting

- **Unable to connect** – make sure the WebSocket server is running, the URL in `mp-config.js` matches, and port `4000` is reachable (check firewalls/NAT).
- **Lobby not found or full** – codes are case-sensitive, expire after an hour, and only support four players. Restart the server to reset stale lobbies.
- **Performance issues** – check FPS in the debug panel, trim lobby size, or close other tabs; rooms past 18 rely on stat scaling instead of enemy floods.
- **Sound muted unexpectedly** – toggle mute in the pause menu; state is persisted in `SaveSystem`.
- **Game fails to load from disk** – prefer `node server.js` or another HTTP server to avoid browser restrictions when loading local files.

For additional help, inspect the browser console (`F12`) and the multiplayer server logs. Bug reports and feedback are welcome through GitHub issues.

