# ============================================================================
# Shape Slayer Multiplayer Server Configuration
# ============================================================================
# Copy this file to .env and configure as needed
# 
# Quick Start:
#   cp .env.example .env
#   npm install
#   npm start
#
# ============================================================================

# ----------------------------------------------------------------------------
# SERVER MODE - Choose one of three modes
# ----------------------------------------------------------------------------
# single = Single server, single thread (simplest, 100-1,000 players)
# multi  = Single server, multi-core with Redis (1,000-5,000+ players)
# slave  = Multi-server mode, connects to master (10,000+ players)
#
# Recommendation: Start with 'single', upgrade to 'multi' when needed
# ----------------------------------------------------------------------------
SERVER_MODE=single

# ----------------------------------------------------------------------------
# MASTER SERVER CONNECTION (required for slave mode)
# ----------------------------------------------------------------------------
# When SERVER_MODE=slave, set these to connect to your master server
# Example: MASTER_SERVER_IP=10.0.0.100 or MASTER_SERVER_IP=master.yourdomain.com
# ----------------------------------------------------------------------------
MASTER_SERVER_IP=localhost
MASTER_SERVER_PORT=6379

# ----------------------------------------------------------------------------
# WORKER CONFIGURATION (multi/slave modes only)
# ----------------------------------------------------------------------------
# Number of worker processes to spawn
# Recommendation: 2-4 workers, max (CPU cores - 2) to avoid OS starvation
# Example: On an 8-core machine, use 4-6 workers
WORKER_COUNT=2

# Maximum connections per worker before considered overloaded
# Triggers load balancing when exceeded
# Recommendation: 500 (conservative), 750 (moderate), 1000 (aggressive)
MAX_CONNECTIONS_PER_WORKER=500

# Maximum lobbies per worker before considered overloaded
# Recommendation: 100 (conservative), 150 (moderate), 200 (aggressive)
MAX_LOBBIES_PER_WORKER=100

# Maximum messages per second per worker before overloaded
# High message rate indicates worker saturation
# Recommendation: 1000 (default), 2000 (high-traffic)
MAX_MESSAGES_PER_SECOND=1000

# Maximum event loop lag (milliseconds) before worker considered overloaded
# Event loop lag indicates CPU saturation
# Recommendation: 100ms (default), 50ms (strict), 200ms (lenient)
MAX_EVENT_LOOP_LAG=100

# ----------------------------------------------------------------------------
# SERVER SETTINGS
# ----------------------------------------------------------------------------
# WebSocket server port
# Default: 4000
# Note: All servers should use the same port when behind a load balancer
PORT=4000

# Unique identifier for this server (useful for multi-server setups)
# Leave empty to auto-generate
# Examples: 'master', 'slave-1', 'us-east-1', etc.
SERVER_ID=

# Server region (optional, for future geo-distribution)
# Examples: 'us-east', 'eu-west', 'asia-pacific'
SERVER_REGION=default

# ----------------------------------------------------------------------------
# REDIS SETTINGS (multi/slave modes only)
# ----------------------------------------------------------------------------
# Redis connection port
# Default: 6379 (standard Redis port)
REDIS_PORT=6379

# Redis password (optional, leave empty if no password)
# Recommendation: Set a strong password for production deployments
REDIS_PASSWORD=

# Auto-manage Redis Docker container (multi mode only)
# Set to 'false' if you're running Redis manually or in a separate container
# Only applies when SERVER_MODE=multi
REDIS_AUTO_MANAGE=true

# Redis Docker image to use (when auto-managing)
# Default: redis:alpine (lightweight, recommended)
# Alternatives: redis:latest, redis:7-alpine
REDIS_IMAGE=redis:alpine

# Redis container name (when auto-managing)
# Change if you have naming conflicts
REDIS_CONTAINER_NAME=shapeslayer-redis

# ----------------------------------------------------------------------------
# LOBBY SETTINGS
# ----------------------------------------------------------------------------
# Maximum players allowed per lobby
# Default: 4
# Note: Changing this requires client-side changes as well
MAX_PLAYERS_PER_LOBBY=4

# Lobby code length (characters)
# Default: 6
# Recommendation: 6-8 characters for good uniqueness
LOBBY_CODE_LENGTH=6

# Auto-cleanup lobbies older than this (milliseconds)
# Default: 3600000 (1 hour)
# Examples: 1800000 (30 min), 7200000 (2 hours)
LOBBY_MAX_AGE=3600000

# How often to check for old lobbies to cleanup (milliseconds)
# Default: 300000 (5 minutes)
LOBBY_CLEANUP_INTERVAL=300000

# ----------------------------------------------------------------------------
# LOAD BALANCING SETTINGS (multi/slave modes only)
# ----------------------------------------------------------------------------
# Health check interval - how often workers report metrics (milliseconds)
# Default: 2000 (2 seconds)
# Lower = faster response to overload, higher = less overhead
HEALTH_CHECK_INTERVAL=2000

# Migration threshold - minimum load difference to trigger migration (0.0-1.0)
# Default: 0.3 (30% difference)
# Example: If worker A is at 80% and worker B is at 40%, difference is 0.4 (40%)
MIGRATION_THRESHOLD=0.3

# Migration cooldown - minimum time between migrations for same lobby (milliseconds)
# Default: 30000 (30 seconds)
# Prevents rapid back-and-forth migrations
MIGRATION_COOLDOWN=30000

# Enable/disable dynamic load balancing
# Set to 'false' to disable automatic lobby migration between workers
ENABLE_LOAD_BALANCING=true

# ----------------------------------------------------------------------------
# LOGGING
# ----------------------------------------------------------------------------
# Log level: debug, info, warn, error
# debug = Very verbose, shows all operations
# info  = Normal operation logs (recommended for production)
# warn  = Only warnings and errors
# error = Only errors
LOG_LEVEL=info

# Log worker health metrics every 2 seconds (true/false)
# Shows: connections, lobbies, messages/sec, event loop lag per worker
# Useful for monitoring and debugging performance
LOG_HEALTH_METRICS=false

# Log load balancing decisions (true/false)
# Shows when lobbies are migrated between workers
# Useful for tuning load balancing thresholds
LOG_LOAD_BALANCING=false

# ============================================================================
# QUICK CONFIGURATION PRESETS
# ============================================================================
# Uncomment and modify one of these presets for quick setup

# ----------------------------------------------------------------------------
# PRESET 1: Development / Testing (Default)
# ----------------------------------------------------------------------------
# SERVER_MODE=single
# PORT=4000
# LOG_LEVEL=debug

# ----------------------------------------------------------------------------
# PRESET 2: Small Production Server (100-1,000 players)
# ----------------------------------------------------------------------------
# SERVER_MODE=single
# PORT=4000
# LOG_LEVEL=info

# ----------------------------------------------------------------------------
# PRESET 3: Medium Production Server (1,000-5,000 players)
# ----------------------------------------------------------------------------
# SERVER_MODE=multi
# WORKER_COUNT=4
# MAX_CONNECTIONS_PER_WORKER=750
# MAX_LOBBIES_PER_WORKER=150
# PORT=4000
# LOG_LEVEL=info

# ----------------------------------------------------------------------------
# PRESET 4: Large Production - Master Server (5,000+ players)
# ----------------------------------------------------------------------------
# SERVER_MODE=multi
# WORKER_COUNT=6
# MAX_CONNECTIONS_PER_WORKER=1000
# MAX_LOBBIES_PER_WORKER=200
# SERVER_ID=master
# PORT=4000
# LOG_LEVEL=warn
# LOG_LOAD_BALANCING=true

# ----------------------------------------------------------------------------
# PRESET 5: Large Production - Slave Server
# ----------------------------------------------------------------------------
# SERVER_MODE=slave
# MASTER_SERVER_IP=10.0.0.100
# MASTER_SERVER_PORT=6379
# WORKER_COUNT=6
# MAX_CONNECTIONS_PER_WORKER=1000
# MAX_LOBBIES_PER_WORKER=200
# SERVER_ID=slave-1
# PORT=4000
# LOG_LEVEL=warn

# ============================================================================
# END CONFIGURATION
# ============================================================================
